第1頁：標題

大家好，我們是第七組。本次報告的主題是「氣象預報系統」，由我擔任組長與簡報主講人。

---

第2頁：分工

本專案依功能模組劃分為三大區塊：資料抓取由 `RequestApi.py` 負責，資料處理由 `app.py` 負責，GUI 資料呈現則整合於 `WeatherGUI.py` 中。各成員依據專長分工合作，確保模組邏輯一致、程式碼具可維護性。

---

第3頁：大綱

本報告將依簡報頁序，逐步介紹專案簡介、執行成果、程式流程圖、使用套件，以及核心原始碼解析三大區塊。重點聚焦於資料的擷取、處理邏輯與使用者介面的程式設計，並嚴格對應簡報內容。

---

第4頁：專案簡介(空)

---

第5頁：專案簡介

本系統透過 Python 串接中央氣象署開放資料 API，提供未來七天天氣預報與地震紀錄查詢兩項功能，並以圖形化介面（GUI）呈現結果，使使用者能直觀地瀏覽即時氣象與地震資訊。

---

第6頁：資料來源

本系統整合數個中央氣象署開放資料 API，包括：天氣觀測、各地區天氣預報、日出日落時間及地震資料。資料以 HTTP 請求方式取得，格式為 JSON，便於程式解析與處理。

---

第7頁：執行結果(空)

---

第8頁：執行結果

展示系統在 Windows 平台執行時的主畫面。介面包含天氣與地震兩大功能頁籤，並內建下拉選單與查詢按鈕，讓使用者可選擇縣市與地區後進行查詢，並由後端即時更新畫面結果。

---

第9頁：流程圖(空)

---

第10頁：流程圖

簡報所附流程圖描述完整的系統運作流程：GUI 啟動後，使用者可選擇進入天氣查詢或地震查詢介面。天氣流程包含選擇縣市與行政區，呼叫 `get_weather_by_loction`，再由 `app.py` 傳遞至 `RequestApi.py` 進行資料抓取並回傳至 GUI 顯示；地震流程則根據查詢類型呼叫 `getEarthquake` 函數並即時顯示結果。

---

第11頁：相關套件(空)

---

第12頁：相關套件

系統依賴下列 Python 套件：

* `requests`：執行 API 請求。
* `tkinter`、`customtkinter`：構建視覺化介面。
* `Pillow`：圖像處理。
* `os`、`datetime`：管理路徑與時間。
* `functools.partial`：事件綁定。

---

第13頁：原始碼重點解說-資料蒐集(空)

---

第14頁：

`RequestApi.py` 中定義 `RequestApi` 類別，集中管理 API 資訊。其屬性包含 API URL、版本、路徑、授權 token、標頭格式、縣市代碼對應表與地震資料 API，統一管理可提升重用性與可維護性。這樣的封裝讓其他模組在調用 API 時無須重複定義，減少錯誤發生與維護成本。

---

第15頁：

`setHeader(self, params={})` 方法實作標頭合併機制，支援動態加入額外參數，保持彈性設定，同時回傳 `None` 表示設定完成。這對需要根據不同 API 呼叫需求增加客製化標頭時非常有用。

---

第16頁：

`send(self, method, api, params)` 函數整合 GET 與 POST 請求處理流程，並將回應包裝為字典結構：包含執行狀態、HTTP 狀態碼、訊息與資料內容。支援錯誤處理，包括 HTTP 錯誤、連線錯誤、逾時等，有助於提高程式健壯性。

---

第17頁：

`getWeatherByCity(self, city, days=3)` 函數依據天數參數選擇對應 API 路徑，再由 city 對照表取得編碼發送請求。透過簡單封裝，其他模組可直接調用此函數取得天氣資料，不需關心具體的 API 邏輯與 URL 組成。

---

第18頁：

`getEarthquake(self, modeType=0)` 函數使用 `modeType` 選擇地震類型，對應不同地震 API 編號，再發送查詢請求並回傳結果。此方法將邏輯封裝簡化，統一提供一個可選參數的呼叫方式，增加彈性。

---

第19頁：原始碼重點解說-資料處理(空)

---

第20頁：

`classify_period_by_end_time(start_time, end_time)` 根據時間區段判斷所屬為白天或晚上，並結構化回傳日期與時段。此邏輯與資料呈現密切相關，可協助 GUI 對齊白天與夜晚的預報格式，提升可讀性。

---

第21頁：

`extract_element_value(element_value, allowed_element_type)` 從單一氣象元素中過濾並擷取目標資訊，回傳標準化格式：日期、時段與對應值清單。可確保不同氣象元素格式一致，有助後續資料整合與畫面顯示。

---

第22頁：

`parse_weather_elements(WeatherElement, allowed_element_type)` 遍歷並整理多個元素欄位，僅保留指定的項目，並將其合併為統一結構。這樣的封裝讓 `get_weather_by_loction()` 可以專注於資料組裝，不需進行欄位拆解。

---

第23頁：

`get_weather_by_loction(city, district, target_elements)` 為主要資料處理流程。整合 API 資料、行政區過濾與元素提取等操作，最終回傳 GUI 所需格式。此函數可視為中繼站，負責將 raw data 轉為可用資料。

---

第24頁：

`calc_water_vapor_pressure(RH, temp)` 計算水氣壓，使用常見氣象公式，為後續體感溫度提供必要參數。此計算具備物理意義，反映空氣中實際含水量。

---

第25頁：

`calc_apparent_temperature(temp, humd, wind_speed)` 函數計算體感溫度，參考濕度與風速，並回傳四捨五入後的溫度數值。透過整合 `calc_water_vapor_pressure()` 的結果，能提供更貼近人類實際感受的溫度資料。

---

第26頁：原始碼重點解說-資料呈現(空)

---

第27頁：

GUI 模組由 `WeatherApp` 類別負責。初始化方法中設定應用視窗為全螢幕，並將所有控制元件初始化。這確保每次啟動都能根據螢幕大小自動調整版面，提升使用者體驗。

---

第28頁：

`load_weather_icons(self)` 載入本地圖示資料夾中所有天氣圖示，並建立字典對應關係。此設計讓主畫面只需查詢字典即可取得對應圖檔，減少重複載入並提升效率。

---

第29頁：

`get_weather(self)` 設定欲查詢的目標氣象元素，再呼叫邏輯層取得資料。此函數亦包含正則表達式與缺失補全機制，使天氣描述更完整且不會因資料缺失導致畫面異常。

---

第30頁：

`format_weather_data(self, data)` 將取得的天氣資料依照日期與時段整理成雙層結構，利於 GUI 表格或區塊式顯示。並輔以星期轉換提升資訊直覺性。

---

第31頁：

`format_earthquake_data(self, data)` 使用預設表頭與欄寬，結合文字換行與高度自動調整，使地震資料可在不同解析度中正常顯示長篇文字而不溢位。

---

第32頁：

地震查詢整合錯誤處理機制，使用 `try/except` 捕捉 API 錯誤或資料格式問題，並將錯誤資訊呈現於提示窗中。此機制對避免程式中斷、提升容錯性具有重要作用。

---

第33頁：

系統支援主題切換功能，透過 `change_appearance_mode()` 方法切換深色、淺色或系統預設主題。此功能對不同環境下使用者的視覺舒適度有正面幫助。

---

第34頁：

系統最終使用 PyInstaller 進行打包，命令：
`pyinstaller --onefile --name "氣象預報系統 Windows/iOS v0.1.0" --noconsole your_script.py`

此打包方式可生成單一可執行檔，簡化部署與安裝流程，支援跨平台運作。

---

第35頁：

報告到此結束，謝謝各位聆聽。
